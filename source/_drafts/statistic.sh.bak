#!/bin/bash

hexo_root=/home/scm/repositories/zaozaool.github.io.hexo
cd $hexo_root

#统计并生成图形报表
declare -A dataByYear
declare -A dataByMonth
declare -A dataByDay
declare -A dataByTag

for file in $(ls $hexo_root/source/_posts); do
    #echo "分析文件：" $hexo_root/source/_posts/$file
    #cat "$hexo_root/source/_posts/$file" | while read line; do
    while read line; do  
        str=${line:0:5}
        #根据日期统计
        if [ "${str}x" = "date:x" ]; then
            
            #日期字符串
            str=${line#*:}
            #echo $str
            
            year=`date -d "$str" +%Y`
            month=`date -d "$str" +%Y-%m`
            day=`date -d "$str" +%Y-%m-%d`
            
            #计算每年的次数
            if [ -z "${dataByYear[$year]}" ]; then
                dataByYear[$year]=1
            else
                let dataByYear[$year]++
            fi
            
            #计算每月的次数
            if [ -z "${dataByMonth[$month]}" ]; then
                dataByMonth[$month]=1
            else
                let dataByMonth[$month]++
            fi
            
            #计算每天的次数
            if [ -z "${dataByDay[$day]}" ]; then
                dataByDay[$day]=1
            else
                let dataByDay[$day]++
            fi
            
            # echo $year ":" ${dataByDay[$year]}
            # echo $month ":" ${dataByDay[$month]}
            # echo $day ":" ${dataByDay[$day]}
        
        
        #根据标签统计
        elif [ "${str}x" = "tags:x" ]; then
            tags=${line#*:} #获取所有tag
            tags=${tags#*[} #去掉前面的[
            tags=${tags%*]} #去掉后面的]
            arr=(${tags//,/ }) #根据,分割 
            
            for i in ${arr[*]}; do
            	#计算每个标签的次数
                if [ -z "${dataByTag[$i]}" ]; then
                    dataByTag[$i]=1
                else
                    let dataByTag[$i]++
                fi
            done
            
        fi
    
    done < "$hexo_root/source/_posts/$file"

done


#打印数组
for key in ${!dataByTag[@]}; do
    echo $key
done


#将每个标签输出到js文件中，供图表使用

